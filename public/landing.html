<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameSquad - Welcome</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/landing.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="landing-page">
    <div class="landing-container">
        <div class="landing-content">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-gamepad"></i>
                </div>
                <h1>GameSquad</h1>
            </div>
            <div class="tagline">
                <p>Find Your Perfect Gaming Team</p>
            </div>
            <div class="auth-options">
                <a href="pages/login.html" class="btn btn-primary">Login</a>
                <a href="pages/register.html" class="btn btn-secondary">Register</a>
            </div>
        </div>
        
        <div class="landing-features">
            <div class="feature">
                <i class="fas fa-users"></i>
                <h3>Find Teammates</h3>
                <p>Connect with players who match your skill level</p>
            </div>
            <div class="feature">
                <i class="fas fa-comment-alt"></i>
                <h3>Real-time Chat</h3>
                <p>Communicate with your team instantly</p>
            </div>
            <div class="feature">
                <i class="fas fa-trophy"></i>
                <h3>Track Progress</h3>
                <p>Monitor your gaming achievements</p>
            </div>
        </div>
    </div>

    <footer class="landing-footer">
        <p>&copy; 2025 GameSquad. All rights reserved.</p>
    </footer>

    <script>
        // Global configuration 
        window.APP_CONFIG = {
            API_URL: '/api'
        };
        
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            // More comprehensive authentication check
            let hasValidUserInfo = false;
            let hasToken = false;
            
            try {
                const userInfoStr = localStorage.getItem('userInfo');
                const token = localStorage.getItem('token');
                
                hasToken = token !== null && token !== undefined && token.trim() !== '';
                
                if (userInfoStr) {
                    const userInfo = JSON.parse(userInfoStr);
                    // Must have valid username
                    hasValidUserInfo = userInfo && 
                                      userInfo.username && 
                                      userInfo.username !== 'Username' &&
                                      userInfo.username.trim() !== '';
                }
            } catch (error) {
                console.error('Error checking auth state:', error);
                hasValidUserInfo = false;
                // Clear corrupted data
                localStorage.removeItem('userInfo');
                localStorage.removeItem('token');
            }
            
            const isAuthenticated = hasValidUserInfo && hasToken;
            console.log('Auth check on landing page:', { hasValidUserInfo, hasToken });
            
            // If the auth state is inconsistent, clear it
            if (hasValidUserInfo !== hasToken) {
                console.log('Inconsistent auth state detected, clearing auth data');
                localStorage.removeItem('userInfo');
                localStorage.removeItem('token');
            } else if (isAuthenticated) {
                // If properly authenticated, redirect to main page
                console.log('User is authenticated, redirecting to index page');
                
                // We'll first validate the token with the server
                async function validateToken() {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`${window.APP_CONFIG.API_URL}/users/validate-token`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        if (response.ok) {
                            // Token is valid, redirect to main page
                            window.location.href = 'index.html';
                        } else {
                            console.log('Token validation failed, clearing auth data');
                            // Token is invalid, clear auth data
                            localStorage.removeItem('userInfo');
                            localStorage.removeItem('token');
                        }
                    } catch (error) {
                        console.error('Error validating token:', error);
                        // On error, clear auth data
                        localStorage.removeItem('userInfo');
                        localStorage.removeItem('token');
                    }
                }
                
                validateToken();
            }
        });
    </script>
</body>
</html>
