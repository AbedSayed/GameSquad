<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameSquad - Welcome</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/landing.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="landing-page">
    <!-- Particle background -->
    <div id="particles-js"></div>
    
    <!-- Animated background elements -->
    <div class="hexagon-grid">
        <!-- Hexagons will be added by JS -->
    </div>
    
    <div class="floating-shapes">
        <!-- Floating shapes will be added by JS -->
    </div>
    
    <div class="landing-container">
        <div class="landing-content">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-gamepad"></i>
                </div>
                <h1>GameSquad</h1>
            </div>
            <div class="tagline">
                <p>Find Your Perfect Gaming Team</p>
            </div>
            
            <!-- Game logos -->
            <div class="game-logos">
                <div class="game-logo"><i class="fas fa-dragon" style="color: #ff6b6b;"></i></div>
                <div class="game-logo"><i class="fas fa-ghost" style="color: #48dbfb;"></i></div>
                <div class="game-logo"><i class="fas fa-hat-wizard" style="color: #a29bfe;"></i></div>
                <div class="game-logo"><i class="fas fa-chess-knight" style="color: #feca57;"></i></div>
                <div class="game-logo"><i class="fas fa-spider" style="color: #ff9ff3;"></i></div>
            </div>
            
            <div class="auth-options">
                <a href="pages/login.html" class="btn-primary">
                    <span>Login</span>
                </a>
                <a href="pages/register.html" class="btn-secondary">
                    <span>Register</span>
                </a>
            </div>
        </div>
        
        <div class="landing-features">
            <div class="feature">
                <i class="fas fa-users"></i>
                <h3>Find Teammates</h3>
                <p>Connect with players who match your skill level and playstyle for the ultimate gaming experience.</p>
            </div>
            <div class="feature">
                <i class="fas fa-comment-alt"></i>
                <h3>Real-time Chat</h3>
                <p>Communicate with your team instantly through text, voice, and video to coordinate strategies.</p>
            </div>
            <div class="feature">
                <i class="fas fa-trophy"></i>
                <h3>Track Progress</h3>
                <p>Monitor your gaming achievements, stats, and growth as you dominate the competition.</p>
            </div>
        </div>
    </div>
    
    <!-- Scroll indicator -->
    <div class="scroll-down">
        <span>Scroll Down</span>
        <i class="fas fa-chevron-down"></i>
    </div>

    <footer class="landing-footer">
        <p>&copy; 2025 GameSquad. All rights reserved.</p>
    </footer>

    <script src="js/particles.min.js"></script>
    <script>
        // Initialize particles.js
        particlesJS('particles-js', {
            "particles": {
                "number": {
                    "value": 80,
                    "density": {
                        "enable": true,
                        "value_area": 800
                    }
                },
                "color": {
                    "value": "#8a2be2"
                },
                "shape": {
                    "type": "circle",
                    "stroke": {
                        "width": 0,
                        "color": "#000000"
                    },
                    "polygon": {
                        "nb_sides": 5
                    }
                },
                "opacity": {
                    "value": 0.3,
                    "random": true,
                    "anim": {
                        "enable": true,
                        "speed": 1,
                        "opacity_min": 0.1,
                        "sync": false
                    }
                },
                "size": {
                    "value": 3,
                    "random": true,
                    "anim": {
                        "enable": true,
                        "speed": 2,
                        "size_min": 0.1,
                        "sync": false
                    }
                },
                "line_linked": {
                    "enable": true,
                    "distance": 150,
                    "color": "#8a2be2",
                    "opacity": 0.2,
                    "width": 1
                },
                "move": {
                    "enable": true,
                    "speed": 1,
                    "direction": "none",
                    "random": true,
                    "straight": false,
                    "out_mode": "out",
                    "bounce": false,
                    "attract": {
                        "enable": false,
                        "rotateX": 600,
                        "rotateY": 1200
                    }
                }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": {
                    "onhover": {
                        "enable": true,
                        "mode": "grab"
                    },
                    "onclick": {
                        "enable": true,
                        "mode": "push"
                    },
                    "resize": true
                },
                "modes": {
                    "grab": {
                        "distance": 140,
                        "line_linked": {
                            "opacity": 0.5
                        }
                    },
                    "bubble": {
                        "distance": 400,
                        "size": 40,
                        "duration": 2,
                        "opacity": 8,
                        "speed": 3
                    },
                    "repulse": {
                        "distance": 200,
                        "duration": 0.4
                    },
                    "push": {
                        "particles_nb": 4
                    },
                    "remove": {
                        "particles_nb": 2
                    }
                }
            },
            "retina_detect": true
        });
        
        // Create hexagon grid
        function createHexagons() {
            const hexGrid = document.querySelector('.hexagon-grid');
            const numHexagons = 15;
            
            for (let i = 0; i < numHexagons; i++) {
                const hex = document.createElement('div');
                hex.className = 'hexagon';
                hex.style.left = `${Math.random() * 100}vw`;
                hex.style.top = `${Math.random() * 100}vh`;
                hex.style.opacity = `${Math.random() * 0.3}`;
                hex.style.transform = `scale(${Math.random() * 0.8 + 0.6})`;
                hexGrid.appendChild(hex);
            }
        }
        
        // Create floating shapes
        function createFloatingShapes() {
            const shapeContainer = document.querySelector('.floating-shapes');
            const numShapes = 8;
            
            for (let i = 0; i < numShapes; i++) {
                const shape = document.createElement('div');
                shape.className = 'floating-shape';
                shape.style.left = `${Math.random() * 100}vw`;
                shape.style.top = `${Math.random() * 100}vh`;
                shape.style.width = `${Math.random() * 100 + 50}px`;
                shape.style.height = `${Math.random() * 100 + 50}px`;
                shape.style.opacity = `${Math.random() * 0.3}`;
                shape.style.animationDuration = `${Math.random() * 10 + 10}s`;
                shape.style.animationDelay = `${Math.random() * 5}s`;
                shapeContainer.appendChild(shape);
            }
        }
        
        // Create scroll animation
        function initScroll() {
            const scrollBtn = document.querySelector('.scroll-down');
            if (scrollBtn) {
                scrollBtn.addEventListener('click', () => {
                    window.scrollTo({
                        top: window.innerHeight,
                        behavior: 'smooth'
                    });
                });
            }
        }
        
        // Global configuration 
        window.APP_CONFIG = {
            API_URL: '/api'
        };
        
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize visual elements
            createHexagons();
            createFloatingShapes();
            initScroll();
            
            // More comprehensive authentication check
            let hasValidUserInfo = false;
            let hasToken = false;
            
            try {
                const userInfoStr = localStorage.getItem('userInfo');
                const token = localStorage.getItem('token');
                
                hasToken = token !== null && token !== undefined && token.trim() !== '';
                
                if (userInfoStr) {
                    const userInfo = JSON.parse(userInfoStr);
                    // Must have valid username
                    hasValidUserInfo = userInfo && 
                                      userInfo.username && 
                                      userInfo.username !== 'Username' &&
                                      userInfo.username.trim() !== '';
                }
            } catch (error) {
                console.error('Error checking auth state:', error);
                hasValidUserInfo = false;
                // Clear corrupted data
                localStorage.removeItem('userInfo');
                localStorage.removeItem('token');
            }
            
            const isAuthenticated = hasValidUserInfo && hasToken;
            console.log('Auth check on landing page:', { hasValidUserInfo, hasToken });
            
            // If the auth state is inconsistent, clear it
            if (hasValidUserInfo !== hasToken) {
                console.log('Inconsistent auth state detected, clearing auth data');
                localStorage.removeItem('userInfo');
                localStorage.removeItem('token');
            } else if (isAuthenticated) {
                // If properly authenticated, redirect to main page
                console.log('User is authenticated, redirecting to home page');
                
                // We'll first validate the token with the server
                async function validateToken() {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`${window.APP_CONFIG.API_URL}/users/validate-token`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        if (response.ok) {
                            // Token is valid, redirect to main page
                            window.location.href = 'home.html';
                        } else {
                            console.log('Token validation failed, clearing auth data');
                            // Token is invalid, clear auth data
                            localStorage.removeItem('userInfo');
                            localStorage.removeItem('token');
                        }
                    } catch (error) {
                        console.error('Error validating token:', error);
                        // On error, clear auth data
                        localStorage.removeItem('userInfo');
                        localStorage.removeItem('token');
                    }
                }
                
                validateToken();
            }
        });
    </script>
</body>
</html>
