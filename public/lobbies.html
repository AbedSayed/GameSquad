<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lobbies - GameSquad</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/lobbies.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Load configuration first -->
    <script src="js/config.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo">
                <i class="fas fa-gamepad"></i>
                <span>GameSquad</span>
            </div>
            <ul class="nav-links">
                <li><a href="home.html">Home</a></li>
                <li><a href="lobbies.html" class="active">Lobbies</a></li>
                <li><a href="pages/profile.html">Profile</a></li>
                <li><a href="pages/about.html">About</a></li>
            </ul>
            <div class="auth-buttons">
                <button id="logoutBtn" class="btn btn-accent">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <div class="notifications-container"></div>
        
        <div class="lobbies-header">
            <h1>Game Lobbies</h1>
            <div class="actions">
                <a href="pages/create-lobby.html" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Create Lobby
                </a>
                <button id="refreshLobbies" class="btn btn-secondary">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        <!-- Filters section -->
        <section class="filters-section">
            <div class="filter-container">
                <div class="filter-group">
                    <label for="gameFilter">Game Type</label>
                    <select id="gameFilter" class="filter-select">
                        <option value="all">All Games</option>
                        <!-- Dynamically populated from config.js -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="statusFilter">Status</label>
                    <select id="statusFilter" class="filter-select">
                        <option value="all">All Statuses</option>
                        <option value="open">Open</option>
                        <option value="full">Full</option>
                        <option value="in-progress">In Progress</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="skillLevelFilter">Skill Level</label>
                    <select id="skillLevelFilter" class="filter-select">
                        <option value="all">All Levels</option>
                        <option value="1">Beginner</option>
                        <option value="2">Casual</option>
                        <option value="3">Intermediate</option>
                        <option value="4">Advanced</option>
                        <option value="5">Expert</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchFilter">Search</label>
                    <div class="search-wrapper">
                        <input type="text" id="searchFilter" placeholder="Search lobbies...">
                        <button id="searchBtn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- My Lobbies Section -->
        <section class="lobbies-section">
            <div class="section-header">
                <h2>MY LOBBIES (<span id="myLobbiesCount">0</span>)</h2>
            </div>
            <div id="myLobbies" class="game-cards-container">
                <!-- My Lobbies will be loaded here -->
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading your lobbies...</p>
                </div>
            </div>
        </section>

        <!-- Other Lobbies Section -->
        <section class="lobbies-section">
            <div class="section-header">
                <h2>OTHER LOBBIES (<span id="otherLobbiesCount">0</span>)</h2>
            </div>
            <div id="otherLobbies" class="game-cards-container">
                <!-- Other Lobbies will be loaded here -->
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading available lobbies...</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-info">
                <p>&copy; 2023 GameSquad. All rights reserved.</p>
            </div>
            <div class="footer-links">
                <a href="pages/terms.html">Terms of Service</a>
                <a href="pages/privacy.html">Privacy Policy</a>
                <a href="pages/contact.html">Contact Us</a>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script src="js/lobbies.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the lobbies module
            const lobbiesModule = new window.LobbiesModule();
            
            // Check if the user is logged in
            const token = localStorage.getItem('authToken') || localStorage.getItem('token');
            if (!token) {
                // Redirect to login page if not authenticated
                window.location.href = 'pages/login.html?redirect=lobbies.html';
                return;
            }
            
            // Get URL parameters for filtering
            const urlParams = new URLSearchParams(window.location.search);
            const initialFilters = {};
            
            // Check for game filter
            if (urlParams.has('game')) {
                const gameFilter = urlParams.get('game');
                initialFilters.game = gameFilter;
                document.getElementById('gameFilter').value = gameFilter;
            }
            
            // Check for status filter
            if (urlParams.has('status')) {
                const statusFilter = urlParams.get('status');
                initialFilters.status = statusFilter;
                document.getElementById('statusFilter').value = statusFilter;
            }
            
            // Check for skill level filter
            if (urlParams.has('skill')) {
                const skillFilter = urlParams.get('skill');
                initialFilters.skillLevel = skillFilter;
                document.getElementById('skillLevelFilter').value = skillFilter;
            }
            
            // Check for search filter
            if (urlParams.has('search')) {
                const searchFilter = urlParams.get('search');
                initialFilters.search = searchFilter;
                document.getElementById('searchFilter').value = searchFilter;
            }
            
            // Load game types from config
            const gameFilter = document.getElementById('gameFilter');
            const gameTypes = window.APP_CONFIG?.GAME_TYPES || ['FPS', 'MOBA', 'RPG', 'Strategy', 'Sports', 'Racing', 'Other'];
            
            gameTypes.forEach(gameType => {
                const option = document.createElement('option');
                option.value = gameType;
                option.textContent = gameType;
                gameFilter.appendChild(option);
            });
            
            // Load lobbies with initial filters
            setTimeout(() => {
                lobbiesModule.loadLobbies(initialFilters);
            }, 500);
            
            // Set up event listeners for filters
            document.getElementById('gameFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('skillLevelFilter').addEventListener('change', applyFilters);
            document.getElementById('searchBtn').addEventListener('click', applyFilters);
            document.getElementById('searchFilter').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });
            
            // Set up refresh button
            document.getElementById('refreshLobbies').addEventListener('click', function() {
                const filters = getFilters();
                lobbiesModule.loadLobbies(filters);
            });
            
            // Set up logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                // Clear authentication data
                localStorage.removeItem('authToken');
                localStorage.removeItem('token');
                localStorage.removeItem('userInfo');
                
                // Redirect to login page
                window.location.href = 'pages/login.html';
            });
            
            // Function to apply filters
            function applyFilters() {
                const filters = getFilters();
                lobbiesModule.loadLobbies(filters);
                
                // Update URL with filter parameters
                const url = new URL(window.location.href);
                
                // Clear existing parameters
                url.search = '';
                const params = new URLSearchParams(url.search);
                
                // Add filter parameters if they have values
                for (const [key, value] of Object.entries(filters)) {
                    if (value && value !== 'all' && value !== '') {
                        params.set(key, value);
                    }
                }
                
                // Update URL without refreshing the page
                window.history.pushState({}, '', url.pathname + '?' + params.toString());
            }
            
            // Function to get current filter values
            function getFilters() {
                return {
                    game: document.getElementById('gameFilter').value,
                    status: document.getElementById('statusFilter').value,
                    skillLevel: document.getElementById('skillLevelFilter').value,
                    search: document.getElementById('searchFilter').value.trim()
                };
            }
        });
    </script>
</body>
</html> 